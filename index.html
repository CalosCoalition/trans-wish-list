<!DOCTYPE html>
<html lang="en">
<head>
<!-- This Code, Application, Images, Data, and all related physical, metaphysical, and software entities related to this application belong to The Calos Coalition, a registered 501c3 non-profit. Developed by Ms. Thea Ross for use within https://www.caloscoalition.com and the Calos App. Reproduction is strictly limited; to share, please share the weblink on our website. To contact us regarding any issues, reach out to admin@caloscoalition.com. -->
<title>Trans Wish List</title>
<!-- Include jQuery (Latest Stable Version) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Include Select2 CSS (Latest Stable Version) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<!-- Include Select2 JavaScript (Latest Stable Version) -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<!-- Include Google API script -->
<script src="https://apis.google.com/js/api.js"></script>
<!-- Include iframe-resizer library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.2/iframeResizer.contentWindow.min.js"></script>
<!-- Include polyfill library for Compatible -->
<script src="https://polyfill.io/v3/polyfill.min.js"></script>
<!-- Do not forget to add vendor tags with autoprefixer and also Minimize the code programatically before final version release -->
<style>
    :root {
      --primary-bg: #C08CCF;
      --text-color: #000000;
      --link-color: #B9F0FF;
      --bold-link-color: #E89AFF;
    }
  
    body {
      font-family: "Roboto", Arial, sans-serif;
      font-size: 12px;
      margin: 0;
      padding: 0;
      background-color: var(--primary-bg);
      color: var(--text-color);
    }
    
    .container {
      width: 100%;
      max-width: 800px; /* Maximum width for the container */
      margin: 0 auto; /* Center the container */
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: center; /* Centers items on the main-axis */
      align-items: center; /* Align items on the cross-axis */
      padding-top: 10px;
    }
    
    .header img {
      width: 140px; /* Adjust the width as needed */
      height: auto; /* Maintain aspect ratio */
      margin-right: 10px; /* Add some space between the image and the heading */
    }
    
    .header h1 {
      font-family: "Roboto Bold", Arial, sans-serif;
      font-size: 26px;
      margin: 0; /* Adjust or remove margin as needed */
      color: #000000; /* Heading color */
    }
    
    .linkBar h2 {
      font-family: "Roboto", Arial, sans-serif;
      font-size: 16px;
      letter-spacing: 6px;
      text-align: center; /* Centers items on the main-axis */
      align-items: center; /* Align items on the cross-axis */
      padding: 0px;
    }
    
    .table-container {
      overflow-x: auto; /* Enable horizontal scrolling for smaller screens */
    }
    
    table {
      width: 98%;
      margin: 0 auto; /* Center the container */
      font-size: 12px;
      border: 2px solid var(--bold-link-color);
      border-radius: 20px;
      padding: 20px;
      background-color: #F0D4FC; /* Primary table background color */
      table-layout: fixed;
    }
    
    thead {
      font-size: 18px;
      padding: 18px;
      text-align: left;
      border-bottom: 2px solid #D9D9D9;
      font-family: "Roboto", Arial, sans-serif;
    }
    
    tbody tr:not(#filterRow):not(#filterDisplayRow):hover td {
      text-decoration: underline;
      font-style: italic;
    }
    
    td {
      padding: 8px;
      text-align: left;
      font-family: "Roboto", Arial, sans-serif;
      cursor: pointer;
    }
    
    th {
      cursor: pointer;
      font-family: "Roboto Bold", Arial, sans-serif; /* Header font bold */
      text-align: left; /* Default text alignment for all table headers */
    }
  
    /* Set specific width to the columns to prevent stretching */
    th:nth-child(1), td:nth-child(1) { width: 10%; }
    th:nth-child(2), td:nth-child(2) { width: 10%; }
    th:nth-child(3), td:nth-child(3) { width: 13%; }
    th:nth-child(4), td:nth-child(4) { width: 25%; }
    th:nth-child(5), td:nth-child(5) { width: 10%; }
    th:nth-child(6), td:nth-child(6) { width: 14%; }
    th:nth-child(7), td:nth-child(7) { width: 10%; }
    th:nth-child(8), td:nth-child(8) { width: 8%; }
  
    /* Set Specific Styles by Table Cell; Center text in the 1st, 5th, and 7th columns (Date Applied, Wish Status, and Verified?) */
    th:nth-child(1), td:nth-child(1),
    th:nth-child(2),
    th:nth-child(3),
    th:nth-child(5), td:nth-child(5),
    th:nth-child(6),
    th:nth-child(7), td:nth-child(7),
    th:nth-child(8), td:nth-child(8) {
      text-align: center;
    }
  
    /* Bold text in the 1st column (Date) */
    th:nth-child(1), td:nth-child(1) {
      font-weight: bold;
    }
  
    /* Italic text in the 8th column (Wish Status) */
    td:nth-child(8) {
      font-style: italic;
    }
  
    /* Link Styling */  
    a {
      text-decoration: none;
      color: var(--link-color);
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    a.bold {
      color: var(--bold-link-color);
      font-weight: bold;
    }
  
    /* Alternating Row Color Styling */
    .odd-row {
      background-color: #F6EAFD;
    }
    
    .even-row {
      background-color: #E8D9F3;
    }
  
    /* Icon Related Styling */
    .icon-cell {
      position: relative;
      text-align: center;
      overflow: visible;
      height: 50px; /* Set according to your needs */
      width: 50px; /* Set according to your needs */
      background-position: center;
      background-size: cover;
      cursor: pointer; /* Optional: changes the cursor on hover to indicate interactiveness */
    }
    
    .newStatus-icon {
      background-image: url('https://lh3.google.com/u/0/d/1HKxEOpBRyE35FUjDOovuR5ZTjskvsTMr');
    }
    
    .newStatus-icon:hover {
      background-image: url('https://lh3.google.com/u/0/d/1HIRdhX_lsmFjNJaabTQz36M-xb1ODz_h');
    }
    
    .fulfilled-icon {
      background-image: url('https://lh3.google.com/u/0/d/1H78Xxha9fcFXA3hic__5plCWFQ9BkagR');
      height: 50px; /* Set according to your needs */
      width: 50px; /* Set according to your needs */
    }
    
    .fulfilled-icon:hover {
      background-image: url('https://lh3.google.com/u/0/d/1HFzgGRYEQq-Q6L0ZEc8csirgzXhfC5i0');
    }
    
    .unfulfilled-icon {
      background-image: url('https://lh3.google.com/u/0/d/1HEiT1SchXaXPVCvH9GXPPTF4KXlY9oka');
      height: 50px;
      width: 50px;
    }
    
    .unfulfilled-icon:hover {
      background-image: url('https://lh3.google.com/u/0/d/1HCdAJf4Hh7IEPfTwb5brteGpUbJTAmVB');
    }
    
    .icon-image {
      width: 100%; /* Maintain aspect ratio */
      height: auto; /* Full height of the cell */
      position: absolute; /* Positioned absolutely within the relative cell */
      top: 50%; /* Center vertically */
      left: 50%; /* Center horizontally */
      transform: translate(-50%, -50%); /* Offset the icon to truly center it */
    }
  
    /* Specific styles for headers in the sortingColumnHeaders row */
    #sortingColumnHeaders th {
      cursor: pointer; /* Ensures cursor appears as pointer */
      background-color: #E8D9F3; /* Gives a distinct background color */
      color: #333; /* Sets text color */
      padding: 10px; /* Adds padding for better spacing */
      border-bottom: 2px solid #C08CCF; /* Adds a border for distinction */
      text-align: center; /* Centers text in headers */
    }
    
    /* Hover effects specifically for headers within sortingColumnHeaders */
    #sortingColumnHeaders th:hover {
      text-decoration: underline; /* Underline on hover for clarity */
      background-color: #F6EAFD; /* Changes background on hover for visibility */
    }
  
    /* Style for the th element containing the toggle filter button search input and reset search button */
    .header-input-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-grow: 1;
      overflow: visible;
    }
    
    #searchInput, #twlIdInput {
      display: inline-block;
      flex-grow: 1;
      padding: 4px;
      box-sizing: border-box;
      height: 26px;
      margin-right: 10px;
      min-width: 60px;
    }
    
    /* Style for the TWL ID # input */
    .twl-input-wrapper {
      display: flex;
      align-items: center;
    }
    
    .twl-input-wrapper input {
      padding-left: 5px;
      width: 30px;
      min-width: 50px;
      margin-right: 10px;
    }
  
    /* Style for the th that contains the reset search button */
    .reset-button-container {
      text-align: left; /* Aligns the button to the left */
    }
  
    /* Targeting the main filter row to disable underline on hover */
    #filterRow {
      display: table-row; /* Ensure filter row is initially visible */
    }
    
    #filterRow th {
      margin: 0 !important; /* Override default margin */
      padding: 0 !important; /* Override default padding */
      text-decoration: none !important; /* Important to override other styles */
    }
    
    /* Specific hover effects for th cells within the filterRow */
    #filterRow:hover, #filterRow th:hover, #filterRow th *:hover {
      text-decoration: none !important;
    }
    
    /* Keep the Filter Select2 Fields the width of the Columns */
    .select2-selection select2-selection--multiple {
      width: 100% !important;
    }
    
    .select2-search--inline .select2-search__field {
      width: 100% !important;
    }
    
    .select2-selection__rendered {
      height: 28px !important;
      line-height: 28px !important;
      color: gray !important;
      font-weight: normal !important;
      text-align: left !important;
      font-size: 12px;
      line-height: normal;
      vertical-align: middle;
    }
    
    .select2-selection__choice {
      display: none !important; /* Hides selected choices */
    }
  
    /* Styling for the filter display row */
    #filterDisplayRow {
      width: 100%;
      background-color: #EFEFEF;
      border-top: 1px solid #ccc;
      padding: 4px 10px;
      overflow-x: auto;
      white-space: nowrap;
      align-items: left;
      max-height: 30px;
      font-size: 10px;
      color: #666;
      text-align: center;
      display: none; /* Ensure filter display row is initially hidden */
    }
    
    #filterDisplayRow span {
      background-color: #D9D9D9;
      margin-right: 3px;
      padding: 2px 2px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    #filterDisplayRow span:hover::after {
      content: " (x)";
      font-weight: bold;
      color: black;
      text-decoration: underline;
    }
    
    #filterDisplayRow .filter-tag {
      text-decoration: none; /* Remove default underline */
    }
    
    #filterDisplayRow .filter-tag:hover {
      text-decoration: underline;
      cursor: pointer;
    }
  
    /* Style for checkbox labels in the filter row */
    .filter-row-checkbox {
      display: inline-block; /* Ensures label and checkbox are on the same line */
      margin-right: 15px; /* Spacing between each checkbox */
      font-size: 10px; /* Adjust the font size as needed */
      font-weight: normal; /* Set the font weight to normal */
      vertical-align: middle; /* Aligns the text vertically in the middle */
      cursor: pointer; /* Changes cursor to pointer to indicate it's clickable */
    }
    
    /* Additional styling for the checkbox input itself */
    .filter-row-checkbox input[type="checkbox"] {
      margin-right: 2px; /* Space between checkbox and label text */
      vertical-align: middle; /* Aligns the checkbox vertically in the middle */
    }
  
    .checkbox-container {
      display: flex;
      justify-content: space-between; /* Evenly space the checkboxes and button */
      align-items: center; /* Vertically center the content */
      width: calc(100% - 25px); /* Ensure the container fills the th and subtract the padding */
      padding-left: 25px; /* Add padding to the left */
    }
    
    #resetFiltersButton, #toggleFiltersButton {
      padding: 4px 8px;
      font-size: 10px;
      cursor: pointer;
      border: 1px solid;
      border-radius: 5px;
      height: auto;
      width: auto;
      font-weight: bold;
      text-decoration: none !important;
      display: inline-block;
    }
    
    .reset-filters-button.hover-effect, .reset-filters-button:hover, #toggleFiltersButton:hover {
      background-color: darkgray; /* Dark gray background color on hover */
    }
    
    .reset-filters-button:active, #toggleFiltersButton:active {
      background-color: #B9F0FF;
    }
    
    th.filter-column {
      padding: 0;
    }
  
    #returnToTopButton {
      background-color: #4CAF50;
      color: white;
      padding: 8px 12px;
      font-size: 8px;
      cursor: pointer;
      border: 1px solid;
      border-radius: 5px;
      height: auto;
      width: auto;
      font-weight: bold;
      text-decoration: none !important;
      margin-bottom: 4px;
      display: inline-block;
    }
  
    /* Pagination Styling */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px 20px;
      width: 100%;
    }
    
    .pagination-controls {
      display: flex;
      justify-content: center; /* Center the pagination controls */
      align-items: center; /* Center the items vertically */
    }
    
    .pagination-controls button, .pagination-controls input {
      font-weight: bold;
      font-size: 12px;
      border: 1px solid;
      border-radius: 5px;
      margin: 0 10px;
      padding: 10px 30px;
    }
    
    .pagination-controls input {
      width: 100px;
      text-align: center;
    }
  
    /* Accessibility Toggle Styling */
    #accessibilityToggleButton {
      background-color: #008CBA;
      color: white;
      padding: 8px 12px;
      font-size: 8px;
      cursor: pointer;
      border: 1px solid;
      border-radius: 5px;
      height: auto;
      width: auto;
      font-weight: bold;
      text-decoration: none !important;
      margin-bottom: 4px;
      display: inline-block;
    }
    
    #date-placeholder {
      font-style: italic;
      font-size: 14px;
      margin-bottom: 10px;
      white-space: nowrap;
      text-align: right;
      float: right;
      overflow: visible;
    }
  
    /* Remove any inherited hover effects that might apply broadly */
    tr:hover {
      text-decoration: none;
    }
    
    /* Ensuring that buttons within any th do not get the underline effect */
    th, tr, td button {
      text-decoration: none !important;
    }
    
    select {
      width: 100%;
      padding: 4px;
      margin-bottom: 2px;
    }
    
    #errorMessage {
      font-weight: bold;
    }
    
    #bottom-disclosure {
      font-style: italic;
      font-size: 9px;
      width: 80%;
      text-align: center;
      color: #521B28;
      margin: 20px auto;
    }
    
    #bottom-disclosure span {
      text-align: center;
    }
  
    /* Wish Urgency Tag Styling */
    .urgency-tag {
      display: inline-block;
      padding: 3px 6px;
      margin: 1px;
      border-radius: 5px;
      color: white;
      font-size: 8px;
    }
    
    .timeframe-tag {
      background-color: #007bff;
    }
    
    .intensity-tag {
      color: black;
      background-color: #D9D9D9;
    }
    
    /* This will ensure only the spans with these classes have the background colors */
    span.urgent-less30 { background-color: red; }
    span.urgent-30to90 { background-color: darkorange; }
    span.urgent-90to180 { background-color: #FFA07A; }
    span.urgent-180to365 { background-color: yellow; }
    span.urgent-over365 { background-color: green; }
    
    .urgent-cell span {
      cursor: pointer;
      font-size: 12px; /* Smaller font size for tags */
      font-weight: bold;
      display: block;
      padding: 2px 4px;  /* Uniform padding around text */
      border-radius: 4px; /* Optional rounded corners */
      margin-left: 3px; /* Space between the intensity and timeframe */
      color: white; /* White text for better visibility */
      height: 20px;
    }
    
    .centered {
      text-align: center;
      vertical-align: middle;
    }
  
    /* Custom Tooltip Styling */
    .image-tooltip-container {
      position: relative;
      display: inline-block;
    }
    
    .tooltip {
      visibility: hidden;
      width: 120px;
      background-color: black;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
      transition: opacity 0.6s;
    }
    
    .tooltip::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: black transparent transparent transparent;
    }
    
    .image-tooltip-container:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
  
    /* Modal popup styles */
    #modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      height: 80%;
      max-height: 500px;
      overflow: auto;
      background-color: #ffffff;
      border: 1px solid #D9D9D9;
      border-radius: 10px;
      padding: 20px;
    }
  
/* Tablet styles */
@media (max-width: 1024px) {
    body {
        font-size: 14px;
        padding: 15px;
    }
    .header, .table-container, table, .container {
        width: 100%;
        margin: 0;
    }
    th, td {
        padding: 6px;
        font-size: 12px;
    }
    /* Adjust specific widths for Tablet View to the columns to prevent crowding */
    th:nth-child(1), td:nth-child(1) { width: 8%; }
    th:nth-child(2), td:nth-child(2) { width: 15%; }
    th:nth-child(3), td:nth-child(3) { width: 15%; }
    th:nth-child(4), td:nth-child(4) { width: 27%; }
    th:nth-child(5), td:nth-child(5) { width: 8%; }
    th:nth-child(6), td:nth-child(6) { width: 13%; }
    th:nth-child(7), td:nth-child(7) { width: 4%; }
    th:nth-child(8), td:nth-child(8) { width: 10%; }
}

/* Mobile styles */
@media (max-width: 768px) {
    body {
        font-size: 12px;
        padding: 10px;
    }
    .header, .table-container, table, .container {
        width: 100%;
        margin: 0;
    }
    th, td {
        padding: 4px;
        font-size: 10px;
    }
    /* Adjust specific widths for Mobile View to the columns to prevent crowding */
    th:nth-child(1), td:nth-child(1) { width: 8%; }
    th:nth-child(2), td:nth-child(2) { width: 15%; }
    th:nth-child(3), td:nth-child(3) { width: 15%; }
    th:nth-child(4), td:nth-child(4) { width: 27%; }
    th:nth-child(5), td:nth-child(5) { width: 8%; }
    th:nth-child(6), td:nth-child(6) { width: 13%; }
    th:nth-child(7), td:nth-child(7) { width: 4%; }
    th:nth-child(8), td:nth-child(8) { width: 10%; }
}

/* Extra small mobile styles */
@media (max-width: 480px) {
    body {
        font-size: 10px;
        padding: 5px;
    }
    .header, .table-container, table, .container {
        width: 100%;
        margin: 0;
    }
    th, td {
        padding: 2px;
        font-size: 8px;
    }
    /* Adjust specific widths for Extra Small Mobile View to the columns to prevent crowding */
    th:nth-child(1), td:nth-child(1) { width: 8%; }
    th:nth-child(2), td:nth-child(2) { width: 15%; }
    th:nth-child(3), td:nth-child(3) { width: 15%; }
    th:nth-child(4), td:nth-child(4) { width: 27%; }
    th:nth-child(5), td:nth-child(5) { width: 8%; }
    th:nth-child(6), td:nth-child(6) { width: 13%; }
    th:nth-child(7), td:nth-child(7) { width: 4%; }
    th:nth-child(8), td:nth-child(8) { width: 10%; }
}  
  </style>
</head>
<body>
    <div class="header">
        <a href="https://twl.caloscoalition.com">
          <img src="https://lh3.google.com/u/0/d/1DBTKzgwpwpH-ff24IlUrY9bkLpSB-7Kl" alt="Calos Coalition Shield Emblem Logo" aria-label="Calos Coalition Home">
        </a>
        <h1><br>Trans Wish List</h1>
      </div>
      <div class="linkBar">
        <h2>
          <a href="https://www.caloscoalition.com/submit-trans-wish" aria-label="Submit Wish">Submit Wish</a> | 
          <a href="https://checkout.square.site/merchant/MLQN0GFW4Y33R/checkout/6E7PPSWJS7UTTQLTCU5GAW2A" aria-label="Donate">Donate</a> | 
          <a href="https://www.caloscoalition.com/submitstory" aria-label="Share Joy">Share Joy</a>
        </h2>
      </div>
      <table id="wishList" aria-label="Trans Wish List">
        <thead>
          <tr style="border: 2px solid black; background-color: #E8D9F3; padding: 2px 2px; border-radius: 4px;">
            <th colspan="8">
              <div class="header-input-container">
                <button id="toggleFiltersButton" style="margin-right: 3px; font-size: 14px; height: 28px; font-weight: bold;" aria-label="Toggle Filters">▼</button>
                <input type="text" id="searchInput" placeholder="Search List..." onkeyup="applyAllFilters()" aria-label="Search List">
                <button id="resetFiltersButton" onclick="resetFilters()" style="margin-left: 3px; width: auto; font-size: 14px; height: 30px; font-weight: bold;" aria-label="Reset Search">Reset Search</button>
              </div>
            </th>
          </tr>
          <tr id="filterRow">
            <th>
              <select id="dateFilter" onchange="applyAllFilters()" style="padding-left: 8px;" multiple aria-label="Filter by Date">
                <option value="30days">Last 30 days</option>
                <option value="60days">Last 60 days</option>
                <option value="90days">Last 90 days</option>
                <option value="180days">Last 180 days</option>
                <option value="365days">Last 365 days</option>
              </select>
            </th>
            <th>
              <select id="locationFilter" onchange="applyAllFilters()" multiple aria-label="Filter by Location">
                <!-- Dynamic options will be added here via JavaScript -->
              </select>
            </th>
            <th>
              <select id="urgencyFilter" onchange="applyAllFilters()" multiple aria-label="Filter by Urgency">
                <option value="1">Less than 30 Days</option>
                <option value="2">30-90 Days</option>
                <option value="3">90-180 Days</option>
                <option value="4">180-365 Days</option>
                <option value="5">A Year or More</option>
              </select>
            </th>
            <th>
              <select id="hasContentFilter" onchange="applyAllFilters()" multiple aria-label="Filter by Content Type">
                <option value="hasImage">Has Image</option>
                <option value="hasLinks">Has Links</option>
                <option value="hasAudio">Has Audio Message</option>
                <option value="hasVideo">Has Video</option>
                <option value="hasNoContent">Has No Content</option>
              </select>
            </th>
            <th>
              <select id="wishStatusFilter" onchange="applyAllFilters()" multiple aria-label="Filter by Wish Status">
                <option value="Fulfilled">Fulfilled</option>
                <option value="Unfulfilled">Unfulfilled</option>
                <option value="New/Unfulfilled">New/Unfulfilled</option>
              </select>
            </th>
            <th>
              <label class="filter-row-checkbox">
                Include: <input type="checkbox" id="includeAnonymous" checked onchange="applyAllFilters()" aria-label="Include Anonymous Wishes">Anonymous
              </label>
            </th>
            <th>
              <label class="filter-row-checkbox">
                <input type="checkbox" id="includeUnverified" checked onchange="applyAllFilters()" aria-label="Include Unverified Wishes">Unverified?
              </label>
            </th>
            <th>
              <div class="twl-input-wrapper">
                <span style="font-size: 10px; font-weight: normal;">TWL-</span><input type="text" id="twlIdInput" onblur="handleTwlInput()" onkeypress="handleTwlKeyPress(event)" maxlength="6" placeholder="######" aria-label="TWL ID">
              </div>
            </th>
          </tr>
          <tr id="filterDisplayRow" onclick="handleFilterRowClick(event);" aria-label="Filter Display Row">
            <!-- Dynamic content to show active filters -->
          </tr>
          <tr id="sortingColumnHeaders">
            <th onclick="sortTable(0)" data-order="asc" aria-label="Sort by Date Applied">Date Applied</th>
            <th onclick="sortTable(1)" data-order="asc" aria-label="Sort by Location">Location</th>
            <th onclick="sortTable(2)" data-order="asc" aria-label="Sort by Wish Urgency">Wish Urgency</th>
            <th onclick="sortTable(3)" data-order="asc" aria-label="Sort by Posting Title">Posting Title</th>
            <th onclick="sortTable(4)" data-order="asc" aria-label="Sort by Wish Status">Wish Status</th>
            <th onclick="sortTable(5)" data-order="asc" aria-label="Sort by Name">Name</th>
            <th onclick="sortTable(6)" data-order="asc" aria-label="Sort by Verified">Verified?</th>
            <th onclick="sortTable(7)" data-order="asc" aria-label="Sort by TWL ID">TWL ID #</th>
          </tr>
        </thead>
        <tbody aria-label="Wish List Body">
          <!-- Table rows will be dynamically populated here -->
        </tbody>
        <tfoot>
          <tr>
            <td>
              <button id="returnToTopButton" onclick="returnToTop()" aria-label="Return to Top">Return to Top</button>
            </td>
            <td colspan="6">
              <div class="pagination-container">
                <div id="pagination-controls" class="pagination-controls" aria-label="Pagination Controls"></div><br>
              </div>
            </td>
            <td class="centered">
              <button id="accessibilityToggleButton" onclick="toggleAccessibility()" aria-label="Toggle Accessibility">Toggle Accessibility</button>
            </td>
          </tr>
          <tr>
            <td colspan="8" style="position: relative; text-align: center;">
              <div id="select-container" style="display: inline-block; width: auto;">
                <select id="rowsPerPage" style="width: 80px;" onchange="updateRowsPerPage()" aria-label="Rows Per Page">
                  <option value="20">20 rows</option>
                  <option value="50">50 rows</option>
                  <option value="100">100 rows</option>
                </select>
              </div>
              <div id="date-placeholder" aria-label="Date Placeholder"></div>
            </td>
          </tr>
        </tfoot>
      </table>
      <span>
        <div id="errorMessage" aria-live="assertive"></div>
      </span>
      <div id="bottom-disclosure" aria-labelledby="bottom-disclosure-heading">
        <span>
          <a href="https://www.caloscoalition.com/">The Calos Coalition</a> is a 501(c)3 non-profit corporation legally incorporated in the State of Virginia. All information displayed above has been filtered to the appropriate anonymity each wish applicant has indicated. If there is an issue, please contact an administrator at <a href="mailto:admin@caloscoalition.com" target="_blank" rel="nofollow">admin@caloscoalition.com</a> or call us directly at +1 (202) 987-8145.<br><br>Please read and agree to our Privacy Policy, Community Guidelines & Terms of Service before engaging with the Trans Wish List or any of our programs or services. These can always be found located at <a href="https://www.caloscoalition.com/policy" target="_blank" rel="nofollow">caloscoalition.com/policy</a>.
        </span>
      </div>
      <div id="modal" aria-labelledby="modal-heading">
        <span onclick="document.getElementById('modal').style.display='none'" style="float:right; font-size: 28px; font-weight: bold; cursor:pointer;" aria-label="Close Modal">&times;</span>
        <p id="detailContent"></p>
        <p><button onclick="copyToClipboard()" aria-label="Copy TWL ID and Open Donation Tab">Copy TWL ID # and Open Donation Tab</button><a href="https://checkout.square.site/merchant/MLQN0GFW4Y33R/checkout/6E7PPSWJS7UTTQLTCU5GAW2A" target="_blank" id="donateLink"> Donate</a></p>
      </div>
<script>
const wishType64pxIcon = [
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Clothing%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Dream%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Educational%20Grant%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Employment%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Experiences%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Family%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Financial%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Food%20%26%20Essentials%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/General%20Aid_Other%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Housing%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Legal%20Aid%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Medical%20Aid%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Mental%20Health%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Pet%20Care%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Self-Care%20%26%20Wellness%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Social%20%26%20Community%20Engagement%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Technology%20%26%20Equipment%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Transition%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Travel%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Type%20Unknown%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(64x64)/Vehicle%20Assistance%20Icon.png"
];

const wishType512pxIcon = [
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Clothing%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Dream%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Educational%20Grant%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Employment%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Experiences%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Family%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Financial%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Food%20%26%20Essentials%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/General%20Aid_Other%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Housing%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Legal%20Aid%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Medical%20Aid%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Mental%20Health%20Support%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Pet%20Care%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Self-Care%20%26%20Wellness%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Social%20%26%20Community%20Engagement%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Technology%20%26%20Equipment%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Transition%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Travel%20Assistance%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Type%20Unknown%20Icon.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/twlWishTypeIcons(512x512)/Vehicle%20Assistance%20Icon.png"
];

const wishStatusIcon = [
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/New%20Wish.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/New%20Wish%20Hover.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/Unfilled.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/Unfilled%20Hover.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/Filled.png",
  "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/wishStatusIcons/Filled%20Hover.png"
];

const calosEmblemAndTextImageURL = "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/calos-emblem-and-text.png";
const unverifiedBadgeURL = "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/verifiedBadge/Unverified.png";
const verifiedBadgeURL = "https://raw.githubusercontent.com/CalosCoalition/trans-wish-list/main/assets/images/verifiedBadge/Verified.png";
let prevSortedColumnIndex = null;
let isFilterVisible = true;
let twlInputTimeout;
let currentPage = 1;
let rowsPerPage = 20;
let accessibilityEnabled = false;
let locationSet = new Set();
let filteredData = [];
// Begin Async Loading of Data to pass for Handling
async function fetchWishListData() {
            try {
                const response = await fetch('https://us-central1-trans-wish-list.cloudfunctions.net/getPublicWishListData');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                console.log('Fetched Data:', data);
                if (data && data.wishes && Array.isArray(data.wishes)) {
                    return data.wishes;
                } else {
                    console.error('Fetched data does not contain an array of wishes');
                    return [];
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                return [];
            }
        }
        function addEventListeners() {
            document.getElementById('dateFilter').addEventListener('change', applyAllFilters);
            document.getElementById('locationFilter').addEventListener('change', applyAllFilters);
            document.getElementById('urgencyFilter').addEventListener('change', applyAllFilters);
            document.getElementById('hasContentFilter').addEventListener('change', applyAllFilters);
            document.getElementById('wishStatusFilter').addEventListener('change', applyAllFilters);
            document.getElementById('includeAnonymous').addEventListener('change', applyAllFilters);
            document.getElementById('includeUnverified').addEventListener('change', applyAllFilters);
            document.getElementById('searchInput').addEventListener('input', applyAllFilters);
            document.getElementById('rowsPerPage').addEventListener('change', updateRowsPerPage);
            document.getElementById('toggleFiltersButton').addEventListener('click', toggleFilterRow);
            document.getElementById('filterDisplayRow').addEventListener('click', handleFilterRowClick);
            document.getElementById('twlIdInput').addEventListener('blur', function() {
                clearTimeout(twlInputTimeout);
                handleTwlInput();
            });
        }
document.addEventListener('DOMContentLoaded', async function() {
  try {
    const data = await fetchWishListData();
    if (!data || !Array.isArray(data)) {
      console.error('No data available or data is not in the correct format.');
      return;
    }

    const datePlaceholder = document.getElementById('date-placeholder');
    const today = new Date();
    const formattedDate = 'Accessed on: ' + today.toLocaleDateString();
    datePlaceholder.textContent = formattedDate;

    addEventListeners();
    enhanceAccessibility();
    initializeSelect2Elements();
    setupToggleButton();

    console.log('Fetched Data:', data);
    handleData(data);
    populateFilters(data);
    applyAllFilters();
    paginateAndRender();

    handleUrlParameters(); // Ensure this is called after data is loaded and rendered

    logInitialFilterRowState();
  } catch (error) {
    console.error('Error fetching wish list data:', error);
  }
});

function handleUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('search');
            const autoOpen = urlParams.get('autoOpen') === 'true';
            console.log(searchQuery, autoOpen);
            const searchInput = document.getElementById('twlIdInput');
            if (searchInput && searchQuery) {
                searchInput.value = searchQuery;
                applyAllFilters();
                paginateAndRender();
                if (autoOpen) {
                    handleTwlInput();
                    const firstVisibleRow = document.querySelector(`#wishList tbody tr[data-item*='${searchQuery}']`);
                    if (firstVisibleRow) {
                        const itemData = JSON.parse(firstVisibleRow.getAttribute('data-item'));
                        openDetailView(itemData);
                        firstVisibleRow.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        window.parent.postMessage({ type: 'scrollToTop' }, '*');
                    } else {
                        console.error('Element not found for scrollIntoView');
                    }
                }
            }
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    applyAllFilters();
                });
            }
        }

        function setupToggleButton() {
            const toggleButton = document.getElementById('toggleFiltersButton');
            if (toggleButton) {
                toggleButton.addEventListener('click', toggleFilterRow);
                console.log('Toggle button found and event listener added.');
            } else {
                console.error('Toggle button not found');
            }
        }

        function logInitialFilterRowState() {
            const filterRow = document.getElementById('filterRow');
            const displayRow = document.getElementById('filterDisplayRow');
            if (filterRow && displayRow) {
                console.log('Initial state - filterRow:', window.getComputedStyle(filterRow).display, 'filterDisplayRow:', window.getComputedStyle(displayRow).display);
            } else {
                console.error('Filter rows not found. filterRow:', filterRow, 'displayRow:', displayRow);
            }
        }

function updateRowsPerPage() {
  const selectedOption = document.getElementById('rowsPerPage').value;
  var numericValue = selectedOption.match(/\d+/);
  rowsPerPage = numericValue ? parseInt(numericValue[0], 10) : 20;
  currentPage = 1;
  applyAllFilters();
  paginateAndRender();
}

function enhanceAccessibility() {
  document.querySelectorAll('table').forEach(table => table.setAttribute('role', 'table'));
  document.querySelectorAll('th').forEach(th => th.setAttribute('role', 'columnheader'));
  document.querySelectorAll('td').forEach(td => td.setAttribute('role', 'cell'));
  document.getElementById('modal').setAttribute('role', 'dialog');
}

function initializeSelect2Elements() {
  const setPlaceholderText = (element, text) => {
    element.select2({
      closeOnSelect: false,
      placeholder: text,
      allowClear: true,
      width: '100%'
    }).on('select2:close', function () {
      $(this).data('select2').$selection.find('.select2-selection__rendered').html(text);
    });
  };

  $('#dateFilter').select2({
    placeholder: ' Filter by Date',
    allowClear: true,
    closeOnSelect: true,
    width: '100%'
  }).on('select2:selecting', function (e) {
    $(this).val(null).trigger('change');
    $(this).val(e.params.args.data.id).trigger('change');
  });

  $('#locationFilter').select2({
    placeholder: 'Select Location',
    closeOnSelect: false,
    tags: true,
    width: '100%'
  });

  setPlaceholderText($('#wishStatusFilter'), 'By Status');
  setPlaceholderText($('#urgencyFilter'), 'By Urgency');
  setPlaceholderText($('#hasContentFilter'), 'By Content');

  $('#rowsPerPage').select2({
    placeholder: 'Rows per page',
    minimumResultsForSearch: Infinity,
    width: '100%'
  });
}
function initializeLocationFilter() {
        const locationFilter = $('#locationFilter');
        const states = ["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY", "AS", "DC", "FM", "GU", "MH", "MP", "PW", "PR", "VI"];
        states.forEach(state => {
            locationFilter.append(new Option(state, state));
        });
        locationFilter.select2({ placeholder: 'By Location', closeOnSelect: false, tags: true});
    }
function applyLocationFilter() {
        const selectedState = $('#locationFilter').val();
        const rows = document.querySelectorAll("#wishList tbody tr");
        rows.forEach(row => {
            const locationText = row.cells[1].textContent; // Assuming location is in the second cell
            row.style.display = locationText.includes(selectedState) ? "" : "none";
        });
    }    
    function populateFilters(data) {
        const locationFilter = document.getElementById('locationFilter');
        const locationSet = new Set(); // Use a set to avoid duplicate locations

        // Add special entries
        locationSet.add("Rather Not Say");
        locationSet.add("United States");

        data.forEach(item => {
            let location = item['Location'].trim();
            // Extract state abbreviation from the location, assuming it might include city names
            const stateRegex = /\b[A-Z]{2}\b/; // Matches two uppercase letters
            const match = location.match(stateRegex);
            if (match) {
                locationSet.add(match[0]); // Adds the state abbreviation
            }
        });

        locationSet.forEach(location => {
            const option = document.createElement('option');
            option.value = location;
            option.textContent = location;
            locationFilter.appendChild(option);
        });

        // Re-initialize Select2 for locationFilter to apply the changes
        $('#locationFilter').select2({ placeholder: 'Select Location', closeOnSelect: false });
    }

function updateFilterDisplayRow() {
  const filterDisplayRow = document.getElementById('filterDisplayRow');
  filterDisplayRow.innerHTML = '';

  const container = document.createElement('div');
  container.style.display = 'flex';
  container.style.flexWrap = 'wrap';
  container.style.width = '100%';
  container.style.alignItems = 'center';
  container.style.justifyContent = 'flex-start';

  const td = document.createElement('td');
  td.setAttribute('colspan', '8');
  td.style.width = '100%';
  td.style.borderRadius = '6px';
  td.appendChild(container);

  const removeFiltersButton = document.createElement('button');
  removeFiltersButton.textContent = 'Remove Filters';
  removeFiltersButton.className = 'reset-filters-button';
  removeFiltersButton.onclick = function() { resetFilters(); };
  removeFiltersButton.style.marginRight = '10px';
  removeFiltersButton.setAttribute('id', 'removeFiltersButton');

  let filtersApplied = false;

  const toggles = [
    { checkboxId: 'includeAnonymous', label: 'EXCLUDING: ANONYMOUS' },
    { checkboxId: 'includeUnverified', label: 'EXCLUDING: UNVERIFIED' },
  ];
  toggles.forEach(toggle => {
    const checkbox = document.getElementById(toggle.checkboxId);
    if (!checkbox.checked) {
      const span = document.createElement('span');
      span.textContent = toggle.label;
      span.className = 'filter-tag';
      span.style.cursor = 'pointer';
      span.style.marginRight = '10px';
      span.onclick = () => {
        checkbox.checked = true;
        applyAllFilters();
      };
      container.appendChild(span);
      filtersApplied = true;
    }
  });

  const searchValue = document.getElementById('searchInput').value.trim();
  if (searchValue) {
    const searchTag = document.createElement('span');
    searchTag.textContent = `SEARCH: ${searchValue}`;
    searchTag.className = 'filter-tag';
    searchTag.style.cursor = 'pointer';
    searchTag.style.marginRight = '10px';
    searchTag.onclick = () => {
      document.getElementById('searchInput').value = '';
      applyAllFilters();
    };
    container.appendChild(searchTag);
    filtersApplied = true;
  }

  const twlIdValue = document.getElementById('twlIdInput').value.trim();
  if (twlIdValue) {
    const twlIdTag = document.createElement('span');
    twlIdTag.textContent = `TWL ID: ${twlIdValue}`;
    twlIdTag.className = 'filter-tag';
    twlIdTag.style.cursor = 'pointer';
    twlIdTag.style.marginRight = '10px';
    twlIdTag.onclick = () => {
      document.getElementById('twlIdInput').value = '';
      applyAllFilters();
    };
    container.appendChild(twlIdTag);
    filtersApplied = true;
  }

  const filters = [
    { element: $('#dateFilter'), label: 'DATE' },
    { element: $('#locationFilter'), label: 'LOCATION' },
    { element: $('#urgencyFilter'), label: 'URGENCY' },
    { element: $('#hasContentFilter'), label: 'CONTENT' },
    { element: $('#wishStatusFilter'), label: 'STATUS' },
  ];
  filters.forEach(filter => {
    filter.element.select2('data').forEach(item => {
      const span = document.createElement('span');
      span.textContent = `${filter.label}: ${item.text}`;
      span.className = 'filter-tag';
      span.style.cursor = 'pointer';
      span.style.marginRight = '10px';
      span.onclick = () => {
        const options = filter.element.find('option');
        options.each(function() {
          if (this.text === item.text) {
            $(this).prop('selected', false);
          }
        });
        filter.element.trigger('change');
        applyAllFilters();
      };
      container.appendChild(span);
      filtersApplied = true;
    });
  });

  if (filtersApplied) {
    container.insertBefore(removeFiltersButton, container.firstChild);
    filterDisplayRow.appendChild(td);
    filterDisplayRow.style.display = 'table-row';
  } else {
    filterDisplayRow.style.display = 'none';
  }
}
    function updateWishUrgency(cell, timeframe, intensity) {
        // Clear the existing content of the cell
        cell.textContent = '';

        // Create span for timeframe
        var timeframeSpan = document.createElement('span');
        timeframeSpan.textContent = timeframe;
        timeframeSpan.classList.add('urgency-tag');

        // Apply specific class based on the timeframe value
        switch (timeframe) {
            case "Less than 30 Days":
                timeframeSpan.classList.add('urgent-less30');
                cell.setAttribute('data-sort', '1');
                break;
            case "30-90 Days":
                timeframeSpan.classList.add('urgent-30to90');
                cell.setAttribute('data-sort', '2');
                break;
            case "90-180 Days":
                timeframeSpan.classList.add('urgent-90to180');
                cell.setAttribute('data-sort', '3');
                break;
            case "180-365 Days":
                timeframeSpan.classList.add('urgent-180to365');
                cell.setAttribute('data-sort', '4');
                break;
            case "1+ Year":
                timeframeSpan.classList.add('urgent-over365');
                cell.setAttribute('data-sort', '5');
                break;
            default:
                timeframeSpan.style.backgroundColor = '#FFFFFF'; // Default to white if no match
                cell.setAttribute('data-sort', '0'); // Default case if no match
        }

        // Create span for intensity
        var intensitySpan = document.createElement('span');
        intensitySpan.textContent = intensity;
        intensitySpan.classList.add('urgency-tag', 'intensity-tag'); // Intensity has its own fixed style

        // Append both spans to the cell
        cell.appendChild(intensitySpan);
        cell.appendChild(timeframeSpan);
    }
function applyAllFilters() {
  const dateFilterValues = $('#dateFilter').val() || [];
  const locationFilterValues = $('#locationFilter').val() || [];
  const urgencyFilterValues = $('#urgencyFilter').val() || [];
  const hasContentFilterValues = $('#hasContentFilter').val() || [];
  const wishStatusFilterValues = $('#wishStatusFilter').val() || [];

  const includeAnonymous = document.getElementById('includeAnonymous').checked;
  const includeUnverified = document.getElementById('includeUnverified').checked;

  const searchValue = document.getElementById('searchInput').value.toLowerCase();
  const twlIdValue = document.getElementById('twlIdInput').value.trim();
  const filterTwlId = "TWL-" + twlIdValue;

  const rows = document.querySelectorAll("#wishList tbody tr");
  filteredData = Array.from(rows).filter(row => {
    let visible = true;

    const daysSince = parseInt(row.getAttribute('data-days'), 10);
    if (dateFilterValues.length > 0) {
      visible = dateFilterValues.some(value => {
        const maxDays = parseInt(value.replace('days', ''), 10);
        return daysSince <= maxDays;
      });
    }

    if (locationFilterValues.length > 0) {
      const location = row.cells[1].textContent;
      visible = visible && locationFilterValues.some(value => location.includes(value));
    }

    if (urgencyFilterValues.length > 0) {
      const urgency = row.cells[2].textContent.trim();
      visible = visible && urgencyFilterValues.some(value => urgency.includes(value));
    }

    if (hasContentFilterValues.length > 0) {
      const hasImage = row.querySelector('img') !== null;
      const hasLinks = row.querySelectorAll('a').length > 0;
      const hasAudio = row.querySelector('audio') !== null;
      const hasVideo = row.querySelector('video') !== null;
      const hasNoContent = !(hasImage || hasLinks || hasAudio || hasVideo);

      visible = visible && hasContentFilterValues.some(value => {
        if (value === 'hasImage') return hasImage;
        if (value === 'hasLinks') return hasLinks;
        if (value === 'hasAudio') return hasAudio;
        if (value === 'hasVideo') return hasVideo;
        if (value === 'hasNoContent') return hasNoContent;
      });
    }

    if (wishStatusFilterValues.length > 0) {
      const wishStatus = row.cells[4].textContent.trim();
      visible = visible && wishStatusFilterValues.includes(wishStatus);
    }

    if (!includeAnonymous && row.cells[5].textContent.trim() === 'Anonymous') {
      visible = false;
    }

    if (!includeUnverified && row.cells[6].textContent.trim() !== '✔️') {
      visible = false;
    }

    if (searchValue && !row.textContent.toLowerCase().includes(searchValue)) {
      visible = false;
    }

    if (twlIdValue && !row.textContent.includes(filterTwlId)) {
      visible = false;
    }

    return visible;
  });

  paginateAndRender();
  updateFilterDisplayRow();
  updateRowColors(); // Update row colors after filtering
}

function paginateAndRender() {
  const startIndex = (currentPage - 1) * rowsPerPage;
  const endIndex = startIndex + rowsPerPage;
  const rows = document.querySelectorAll("#wishList tbody tr");

  rows.forEach((row, index) => {
    row.style.display = index >= startIndex && index < endIndex ? '' : 'none';
  });

  const totalPages = Math.ceil(filteredData.length / rowsPerPage);
  const paginationControls = document.getElementById('pagination-controls');

  paginationControls.innerHTML = '';

  if (totalPages > 1) {
    const firstButton = document.createElement('button');
    firstButton.textContent = '<< First';
    firstButton.disabled = currentPage === 1;
    firstButton.onclick = () => {
      currentPage = 1;
      paginateAndRender();
    };
    paginationControls.appendChild(firstButton);

    const prevButton = document.createElement('button');
    prevButton.textContent = '< Prev';
    prevButton.disabled = currentPage === 1;
    prevButton.onclick = () => {
      currentPage--;
      paginateAndRender();
    };
    paginationControls.appendChild(prevButton);

    const nextButton = document.createElement('button');
    nextButton.textContent = 'Next >';
    nextButton.disabled = currentPage === totalPages;
    nextButton.onclick = () => {
      currentPage++;
      paginateAndRender();
    };
    paginationControls.appendChild(nextButton);

    const lastButton = document.createElement('button');
    lastButton.textContent = 'Last >>';
    lastButton.disabled = currentPage === totalPages;
    lastButton.onclick = () => {
      currentPage = totalPages;
      paginateAndRender();
    };
    paginationControls.appendChild(lastButton);

    const currentPageSpan = document.createElement('span');
    currentPageSpan.textContent = `Page ${currentPage} of ${totalPages}`;
    paginationControls.appendChild(currentPageSpan);
  }
}

function handleData(data) {
    if (!data) {
        return;
    }
    const tableBody = document.querySelector("#wishList tbody");
    tableBody.innerHTML = ""; // Clear previous entries
    data.forEach(item => {
        const row = tableBody.insertRow();
        row.setAttribute('data-item', JSON.stringify(item)); // Add this line for Search Bar
        
        // Set the 'data-days' attribute for each row
        row.setAttribute('data-days', item.daysSince); // 'daysSince' is calculated and passed from the server
        
        // Set Date Applied with a sortable ISO string in the 'data-sort' attribute
        const cellDate = row.insertCell();
        const date = new Date(item['Date Applied']);
        const formattedDate = date.toISOString().slice(0, 10);
        cellDate.textContent = formattedDate;
        cellDate.setAttribute('data-sort', date.toISOString());
        
        // Set Location
        const cellLocation = row.insertCell();
        cellLocation.textContent = item['Location'];
        
        // Handle Wish Urgency
        const cellUrgency = row.insertCell();
        const fullUrgencyText = item['Wish Urgency'];
        const urgencyParts = fullUrgencyText.split(", "); // Assuming the format is "Intensity, Timeframe"

        // Use the updateWishUrgency function to handle the cell content and styling
        updateWishUrgency(cellUrgency, urgencyParts[1], urgencyParts[0]); // Note the order: timeframe, intensity
        
        // Determine content availability based on preferences and actual content
        const hasImage = item['Content Preferences'].includes('Photo(s)') && item['Image URL'] ? true : false;
        const hasAudio = item['Content Preferences'].includes('Voice Recording') && item['Recorded Message URL'] ? true : false;
        const hasVideo = item['Content Preferences'].includes('Video Link') && item['Link to Video'] ? true : false;
        const hasLinks = item['Links'] ? true : false;
        const hasNoContent = item['Content Preferences'].trim() === 'Wish Story' && !hasImage && !hasAudio && !hasVideo && !hasLinks;
        // Set Content Related attributes based on content checks
        row.setAttribute('data-has-image', hasImage);
        row.setAttribute('data-has-audio', hasAudio);
        row.setAttribute('data-has-video', hasVideo);
        row.setAttribute('data-has-links', hasLinks);
        row.setAttribute('data-has-no-content', hasNoContent);

        // Set Posting Title
        const cellTitle = row.insertCell();
        cellTitle.textContent = item['Posting Title'];

        // Set Wish Status with Images
        const statusContainer = document.createElement('div');
        statusContainer.className = 'image-tooltip-container';
        const cellWishStatus = row.insertCell();
        const wishStatus = item['Wish Status'];
        let statusSortValue = '';
        const statusImage = document.createElement('img');
        statusImage.style.display = 'block';
        statusImage.style.margin = 'auto';
        statusImage.style.overflow = 'visible';
        statusImage.style.maxWidth = '50px';
        statusImage.style.maxHeight = '50px';
        const statusTooltip = document.createElement('span');
        statusTooltip.className = 'tooltip';
        statusTooltip.textContent = wishStatus; // Tooltip text
        if (wishStatus === 'New/Unfulfilled') {
            row.setAttribute('data-sort', 'New/Unfulfilled');  // New/Unfulfilled
            statusImage.src = 'https://lh3.google.com/u/0/d/1HKxEOpBRyE35FUjDOovuR5ZTjskvsTMr';
            statusImage.className = 'icon-cell newStatus-icon';
            statusImage.alt = 'New/Unfulfilled';
            statusSortValue = '3';
        } else if (wishStatus === 'Unfulfilled') {
            statusImage.src = 'https://lh3.google.com/u/0/d/1HEiT1SchXaXPVCvH9GXPPTF4KXlY9oka';//URL to Unfulfilled Image
            statusImage.className = 'icon-cell unfulfilled-icon';
            statusImage.alt = 'Unfulfilled';
            statusSortValue = '2';
            row.setAttribute('data-sort', 'Unfulfilled');  // Unfulfilled
        } else if (wishStatus === 'Fulfilled') {
            statusImage.src = 'https://lh3.google.com/u/0/d/1H78Xxha9fcFXA3hic__5plCWFQ9BkagR'; //URL to Fulfilled Image
            statusImage.className = 'icon-cell fulfilled-icon';
            statusImage.alt = 'Fulfilled';
            statusSortValue = '1';
            row.setAttribute('data-sort', 'Fulfilled');  // Fulfilled
        }
        statusContainer.appendChild(statusImage);
        statusContainer.appendChild(statusTooltip); // Append the tooltip to the container
        cellWishStatus.appendChild(statusContainer); // Append the container to the cell
        cellWishStatus.setAttribute('data-sort', statusSortValue);

        // Set Public Name
        const cellName = row.insertCell();
        cellName.textContent = item['Public Name'];
        // Sort alphabetically by public name
        cellName.setAttribute('data-sort', item['Public Name'].toLowerCase()); // Use lowercase for consistent sorting

        // Set Verified Status with Images
        const verificationContainer = document.createElement('div');
        verificationContainer.className = 'image-tooltip-container';
        const cellVerified = row.insertCell();
        const verificationStatus = item['Verified?'];
        let sortValue = '';
        const verifiedImage = document.createElement('img');
        verifiedImage.style.display = 'block';
        verifiedImage.style.margin = 'auto';
        verifiedImage.style.overflow = 'visible';
        verifiedImage.style.maxWidth = '40px';
        verifiedImage.style.maxHeight = '40px';
        const verifiedTooltip = document.createElement('span');
        verifiedTooltip.className = 'tooltip';
        verifiedTooltip.textContent = verificationStatus; // Tooltip text
        if (verificationStatus === 'Pending') {
            cellVerified.textContent = verificationStatus;
            cellVerified.style.textAlign = 'center';
            row.setAttribute('data-verified', 'Pending');  // Pending
            sortValue = '3';
        } else if (verificationStatus === 'Unverified') {
            verifiedImage.src = 'https://lh3.google.com/u/0/d/1FRB5gDmVzKlWf6DX6GD2LfEZgmsseyvQ';
            verifiedImage.alt = 'Unverified';
            sortValue = '2';
            row.setAttribute('data-verified', 'Unverified');  // Unverified
        } else if (verificationStatus === 'Verified') {
            verifiedImage.src = 'https://lh3.google.com/u/0/d/1ylrnVGjCtac2ABcXk-SMA6Is3hueS-j9';
            verifiedImage.alt = 'Verified';
            sortValue = '1';
            row.setAttribute('data-verified', 'Verified');  // Verified
        }
        verificationContainer.appendChild(verifiedImage);
        verificationContainer.appendChild(verifiedTooltip); // Append the tooltip to the container
        cellVerified.appendChild(verificationContainer); // Append the container to the cell
        cellVerified.setAttribute('data-sort', sortValue);
        
        // Set TWL ID # (assuming numeric sorting)
        const cellID = row.insertCell();
        cellID.textContent = item['TWL ID #'];
        cellID.setAttribute('data-sort', parseInt(item['TWL ID #'], 10).toString());

        // Add click event listener for the detail view modal
        row.addEventListener('click', () => openDetailView(item));
    });
}

function sortTable(columnIndex) {
  const table = document.querySelector("#wishList tbody");
  const rows = Array.from(table.rows);
  const order = prevSortedColumnIndex === columnIndex ? 'desc' : 'asc';

  rows.sort((a, b) => {
    const cellA = a.cells[columnIndex].innerText;
    const cellB = b.cells[columnIndex].innerText;

    if (order === 'asc') {
      return cellA.localeCompare(cellB, undefined, { numeric: true });
    } else {
      return cellB.localeCompare(cellA, undefined, { numeric: true });
    }
  });

  rows.forEach(row => table.appendChild(row));
  prevSortedColumnIndex = order === 'asc' ? columnIndex : null;
}

function returnToTop() {
  document.documentElement.scrollTop = 0;
}

// Function for handling TWL Search Bar Input
    function handleTwlInput() {
        var input = document.getElementById('twlIdInput');
        var value = input.value.replace(/\D/g, ''); // Remove non-digit characters
        value = value.padStart(6, '0'); // Pad with leading zeros to make it 6 digits
        input.value = value; // Update input value
        
        if (value === "000000") {
            input.value = ''; // Clear the input value
            updateFilterDisplayRow();
        } else {
            applyAllFilters(); // Call the combined filter function
            updateFilterDisplayRow(); // Re-render the filter display row
            updateRowColors(); // Update row colors after filtering
        }
    }

// Handle key press event
        function handleTwlKeyPress(event) {
            clearTimeout(twlInputTimeout); // Clear previous timeout
            if (event.key === 'Enter') {
                handleTwlInput();
            } else {
                twlInputTimeout = setTimeout(handleTwlInput, 5000); // Set timeout for 5 seconds
            }
        }

        function toggleFilterRow() {
            var filterRow = document.getElementById('filterRow');
            var displayRow = document.getElementById('filterDisplayRow');
            var button = document.getElementById("toggleFiltersButton");

            if (filterRow && displayRow) {
                // Log current display properties before toggling
                console.log("Before toggle - filterRow display:", window.getComputedStyle(filterRow).display, "displayRow display:", window.getComputedStyle(displayRow).display);

                // Toggle visibility based on the global state
                if (isFilterVisible) {
                    filterRow.style.display = 'none';
                    displayRow.style.display = 'none'; // Ensure displayRow is hidden
                    button.textContent = "▲";
                    console.log("Rows hidden");
                } else {
                    filterRow.style.display = 'table-row';
                    if (displayRow.children.length > 0) { // Only show displayRow if it has children
                        displayRow.style.display = 'table-row';
                    } else {
                        displayRow.style.display = 'none';
                    }
                    button.textContent = "▼";
                    console.log("Rows shown");
                }
                // Update the global state
                isFilterVisible = !isFilterVisible;
            }
        }

function openDetailView(item) {
  const modal = document.getElementById('modal');
  const detailContent = document.getElementById('detailContent');

  const detailsHTML = `
    <h3>${item.Posting_Title}</h3>
    <img src="${wishType512pxIcon[item.WishTypeIconIndex]}" alt="${item.Wish_Type}" title="${item.Wish_Type}" class="icon-image">
    <p><strong>Details:</strong> ${item.Description}</p>
    <p><strong>Status:</strong> ${item.Wish_Status}</p>
    <p><strong>Name:</strong> ${item.Name}</p>
    <p><strong>Location:</strong> ${item.Location}</p>
    <p><strong>Urgency:</strong> ${item.Wish_Urgency}</p>
    <p><strong>Verified:</strong> ${item.Verified ? 'Yes' : 'No'}</p>
    <p><strong>Date Applied:</strong> ${item.Date_Applied}</p>
    <p><strong>TWL ID:</strong> ${item.TWL_ID}</p>
  `;
  detailContent.innerHTML = detailsHTML;

  modal.style.display = 'block';
}

function copyToClipboard() {
  const modal = document.getElementById('modal');
  const detailContent = document.getElementById('detailContent');
  const twlId = detailContent.querySelector('p:contains("TWL ID:")').innerText.split(':')[1].trim();

  const textToCopy = `TWL ID: ${twlId}`;
  navigator.clipboard.writeText(textToCopy).then(() => {
    const donateLink = document.getElementById('donateLink');
    donateLink.click();
  }).catch(err => {
    console.error('Failed to copy text:', err);
  });
}

function toggleAccessibility() {
  accessibilityEnabled = !accessibilityEnabled;
  if (accessibilityEnabled) {
    document.body.style.fontSize = '16px';
    document.body.style.lineHeight = '1.6';
  } else {
    document.body.style.fontSize = '12px';
    document.body.style.lineHeight = '1.4';
  }
}

function resetFilters() {
          // Clear all select inputs
          const selects = document.querySelectorAll('#filterRow select');
          selects.forEach(select => {
              $(select).val(null).off('change').trigger('change');
              $(select).on('change', applyAllFilters); // Reattach event listener after reset
          });
          // Reset checkboxes to default checked state
          document.querySelectorAll('#filterRow input[type="checkbox"]').forEach(checkbox => {
              checkbox.checked = true;
          });
          document.getElementById('searchInput').value = ''; // Clear the search input
          document.getElementById('twlIdInput').value = ''; // Clear the TWL ID input
          applyAllFilters(); // Reapply filters to update view
      }
      function updateRowColors() {
        const visibleRows = document.querySelectorAll("#wishList tbody tr:not([style*='display: none'])");
        visibleRows.forEach((row, index) => {
            // Remove all possible color classes
            row.classList.remove('odd-row', 'even-row');  // Assuming 'odd-row' and 'even-row' are your color classes

            // Add color class based on whether the index is even or odd
            if (index % 2 === 0) {
                row.classList.add('even-row');
            } else {
                row.classList.add('odd-row');
            }
        });
    }
      function handleFilterRowClick(event) {
        const button = document.getElementById('removeFiltersButton');
        // Check if the clicked element is not one of the filter removal links (span tags)
        if (!event.target.closest('span')) {
            // Simulate hover effect
            button.classList.add('hover-effect');
            setTimeout(() => {
                button.classList.remove('hover-effect');
            }, 200); // This timeout removes the hover effect shortly after it's applied

            // Simulate click effect
            button.classList.add('active');
            setTimeout(() => {
                button.classList.remove('active');
            }, 150); // This timeout removes the active effect, making it seem like a quick press

            // Finally trigger the button's default action
            button.click();
        }
    } 
</script>
</body>
</html>